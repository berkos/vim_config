class Ability
  include CanCan::Ability
  include AuthorizationHelper

  def initialize(user)
    #can :read, :all                   # allow everyone to read everything
    if user && user.role == "admin"
      can :access, :rails_admin       # only allow admin users to access Rails Admin
      can :dashboard                  # allow access to dashboard
      can :manage, :all             # allow superadmins to do anything
      can :import, :salaries
      can :vc, :view
      can :create, :nba_alerts
    end

    can :index, MlbLineup if premium_authorization(user, 'mlb basic')

    can :index, MlbLineupDeluxe  if premium_authorization(user, 'mlb')

    can :nfl, nil if valid_add_on_subscription?(user, 'nfl')

    can :nba, nil if premium_authorization(user, 'nba')

    can :batman, nil if valid_add_on_subscription?(user, 'mlb')

    can :nfl_projections, nil if valid_add_on_subscription?(user, 'nfl')

    return if user.nil?

    can :add_on_selection, nil unless user.subscriptions.empty? #dont allow a user to subcribe to an add-on without having already a premium account.

    can :read, Article, Article do |article|
      can_read_specific(article, user)
    end
  end
end
